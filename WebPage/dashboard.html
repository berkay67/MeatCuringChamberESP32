<!DOCTYPE html>

<html>
<head>
	<title>Chamber Control</title>
	<script>


		setTmpStr = "";
		setHumStr = "";
		
		function getESPIO() {
			nocache = "&nocache=" + Math.random() * 1000000;
			// nocache = "&nocache"
			var request = new XMLHttpRequest();

			request.onreadystatechange = function() {
				if (this.readyState == 4) {
					if (this.status == 200) {
						if (this.responseXML != null) {
							
							document.getElementsByClassName("readTemperatureC")[0].innerHTML = 
							this.responseXML.getElementsByTagName('tempC')[0].childNodes[0].nodeValue;

							document.getElementsByClassName("readTemperatureF")[0].innerHTML = 
							this.responseXML.getElementsByTagName('tempF')[0].childNodes[0].nodeValue;														

							document.getElementsByClassName("readHumidity")[0].innerHTML = 
							this.responseXML.getElementsByTagName('hum')[0].childNodes[0].nodeValue;

							document.getElementsByClassName("setPointTemperature")[0].innerHTML = 
							this.responseXML.getElementsByTagName('settmp')[0].childNodes[0].nodeValue;
														
							document.getElementsByClassName("setPointHumidity")[0].innerHTML = 
							this.responseXML.getElementsByTagName('sethum')[0].childNodes[0].nodeValue;																		
						}
					}
				}					
			}

			request.open("GET", "updateData" + setHumStr + setTmpStr + nocache, true);
			request.send(null);
			setTimeout('getESPIO()', 2000);

			setTmpStr = "";
			setHumStr = "";

		}

		function setHumTmp(){

			var setTemperature = document.getElementsByName("setTemperature")[0].value;
			var setHumidity = document.getElementsByName("setHumidity")[0].value;

			if(!((setTemperature == "") || (setHumidity == ""))) {
				setTmpStr = "&setTmp=" + (setTemperature).padStart(5, "0");					

				setHumStr = "&setHum=" + (setHumidity).padStart(5, "0");	;			
			} else {
				alert("Invalid input parameter !!! \nPlease input valid temperature and humidity value !!!");
			}
		}

	</script>

	<style>	
		header, footer {
			padding: 1em;
			color: white;
			background-color: green;
			clear: left;
			text-align: center;
		}
		nav {		
			float: left;
			border-right: thik soli #ff0000;
			max-width: 160px;
			margin: 20px;
			padding: 1em;
		}
		.controlTmpHum, .readTempHum {
			float: center
			padding: 1em;
			overflow: hidden;		
		}		
	</style>
</head>

<body onload="getESPIO()">
	<header><h1> Meat Locker V 2.0 </h1></header>

	<div class="controlTmpHum">
		<form>
			<p>
				Set Humidity (%RH): <input type="number" steps="any" min="0.0" max="100.0" name="setHumidity"> 
				<input type="button" value = "SET" onclick="setHumTmp()">
			</p>
		</form>

		<form>
			<p>					
				Set Temperature (&degC): <input type="number" steps="any" min="0.0" max="1000.0" name="setTemperature">
				<input type="button" value = "SET" onclick="setHumTmp();">
			</p>						
		</form>


	</div>

	<div class="dispSetHumTmp">
		<p>Humidity Set Point: <span class="setPointHumidity"> ...</span>%RH</p> 
		<p>Temperature Set Point: <span class="setPointTemperature"> ...</span>&degC</p> 
	</div>

	<div class="readHum">
		<p>Current Humidity: <span class="readHumidity"> ...</span>%RH</p> 
	</div>

	<div class="readTmp">
		<p>Current Temperature: <span class="readTemperatureC"> ...</span>&degC  <span class="readTemperatureF"> ...</span>&degF</p> 
	</div>

	<footer>
		<p>
			Copyright &copy <i>Kyel Schaub, 2018</i>
		</p>
	</footer>

</body>
</html>